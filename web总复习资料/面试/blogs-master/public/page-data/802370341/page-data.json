{"componentChunkName":"component---src-templates-blog-post-js","path":"/802370341/","result":{"data":{"site":{"siteMetadata":{"title":"ssh的博客","author":"ssh"}},"markdownRemark":{"id":"c75896fa-3f5f-5db2-ab2b-7b046b1d229c","html":"<p>Vuex 4 官方版本正式发布。</p>\n<p>Vuex 4 的重点是<strong>兼容性</strong>。Vuex 4 支持 Vue 3，但是仍然提供了与 Vuex 3 完全相同的 API，因此用户可以在 Vue 3 中直接<strong>复用他们现有的 Vuex 代码</strong>。</p>\n<p>下文会把破坏性的改动列出来，请注意查看。</p>\n<p>在<a href=\"https://github.com/vuejs/vuex/tree/v4.0.0/examples\" title=\"源码的 example 文件夹\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">源码的 example 文件夹</a>可以看到 Optional 和 Composition API 下的基本用法。</p>\n<p>它仍然和 Vue 3 一样在 NPM 包的 next 标签下发布，我们计划在 Vue3 准备好的时候移除 next 标签。</p>\n<p>为了 Vuex 4 的稳定发布，大家齐心协力做出了很多贡献。非常感谢你们的帮助。若不是有如此出色的 Vue 社区，根本不可能实现这一切！</p>\n<h2 id=\"文档\"><a href=\"#%E6%96%87%E6%A1%A3\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>文档</h2>\n<p>请访问 <a href=\"https://next.vuex.vuejs.org/\" title=\"next.vuex.vuejs.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">next.vuex.vuejs.org</a> 查看文档。</p>\n<h2 id=\"破坏性变动\"><a href=\"#%E7%A0%B4%E5%9D%8F%E6%80%A7%E5%8F%98%E5%8A%A8\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>破坏性变动</h2>\n<h3 id=\"安装流程更改\"><a href=\"#%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B%E6%9B%B4%E6%94%B9\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>安装流程更改</h3>\n<p>为了和 Vue3 的初始化流程一致，Vuex 的安装流程有所改动。</p>\n<p>我们建议用户用新的 <code class=\"language-text\">createStore</code> 函数来建立一个 <code class=\"language-text\">store</code> 实例。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createStore <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"vuex\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> store <span class=\"token operator\">=</span> <span class=\"token function\">createStore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      count<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>同时这在技术上并不是一个破坏性的改动，你依然可以用 <code class=\"language-text\">new Store(...)</code> 语法，不过我们推荐你用新语法，这样可以和 Vue3 以及 Vue Router 4 保持一致。</p>\n</blockquote>\n<p>在 Vue 实例上安装 Vuex，传递 store 即可。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createApp <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"vue\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> store <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./store\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> App <span class=\"token keyword\">from</span> <span class=\"token string\">\"./App.vue\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">createApp</span><span class=\"token punctuation\">(</span>App<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#app\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"构建产物和-vue3-一致\"><a href=\"#%E6%9E%84%E5%BB%BA%E4%BA%A7%E7%89%A9%E5%92%8C-vue3-%E4%B8%80%E8%87%B4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>构建产物和 Vue3 一致</h3>\n<p>以下的构建产物可以和 Vue3 的产物保持一致：</p>\n<ul>\n<li>\n<p><code class=\"language-text\">vuex.global(.prod).js</code></p>\n<ul>\n<li>直接在浏览器中使用 <code class=\"language-text\">&lt;script src=&quot;...&quot;&gt;</code>，暴露全局 Vuex 变量。</li>\n<li>全局构建会被打包成 IIFE，并不是 UMD，仅用于直接使用 <code class=\"language-text\">&lt;script src=&quot;...&quot;&gt;</code> 引入。</li>\n<li>包含了硬编码的 <code class=\"language-text\">prod/dev</code> 分支判断，<code class=\"language-text\">prod.js</code> 是压缩后的，在生产环境记得使用这个文件。</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">vuex.esm-broswer(.prod).js</code></p>\n<ul>\n<li>为了使用 native ES module imports（需要浏览器支持 es module 用法，<code class=\"language-text\">&lt;script type=&quot;module&quot;&gt;</code>）</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">vuex.esm-bundler.js</code></p>\n<ul>\n<li>为了通过 <code class=\"language-text\">webpack</code>, <code class=\"language-text\">rollup</code>, <code class=\"language-text\">percel</code> 等构建工具使用模块。</li>\n<li>保留 <code class=\"language-text\">prod/dev</code> 分支判断和 <code class=\"language-text\">process.env.NODE_ENV</code> 判断（这个变量需要被构建工具替换）</li>\n<li>并不会提供 minified 版本（构建工具可以引入后一起处理）</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">vuex.cjs.js</code></p>\n<ul>\n<li>为了使用 Node.js 服务端渲染时通过 <code class=\"language-text\">require()</code> 导入。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"类型-componentcustomproperties\"><a href=\"#%E7%B1%BB%E5%9E%8B-componentcustomproperties\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>类型 <code class=\"language-text\">ComponentCustomProperties</code></h3>\n<p>Vuex 4 移除了为了推导 <code class=\"language-text\">this.$store</code> 而编写的全局类型，解决了 <a href=\"https://github.com/vuejs/vuex/issues/994\" title=\"issue #994\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">issue #994</a>，在使用 TypeScript 时，你必须自己手动添加模块类型声明。</p>\n<p>在项目中使用如下的代码，<code class=\"language-text\">this.$store</code> 就可以正确推导：</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// vuex-shim.d.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ComponentCustomProperties <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"vue\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Store <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"vuex\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">\"@vue/runtime-core\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Declare your own store states.</span>\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">State</span> <span class=\"token punctuation\">{</span>\n    count<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ComponentCustomProperties</span> <span class=\"token punctuation\">{</span>\n    $store<span class=\"token punctuation\">:</span> Store<span class=\"token operator\">&lt;</span>State<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"核心模块中导出-createlogger-函数\"><a href=\"#%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97%E4%B8%AD%E5%AF%BC%E5%87%BA-createlogger-%E5%87%BD%E6%95%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>核心模块中导出 <code class=\"language-text\">createLogger</code> 函数</h3>\n<p>在 Vuex 3 中, <code class=\"language-text\">createLogger</code> 函数从 <code class=\"language-text\">vuex/dist/logger</code> 中导出，现在它被包含在核心包中了，你可以直接这样导入：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createLogger <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"vuex\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"自-400-rc2-以来的-bug-修复\"><a href=\"#%E8%87%AA-400-rc2-%E4%BB%A5%E6%9D%A5%E7%9A%84-bug-%E4%BF%AE%E5%A4%8D\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>自 4.0.0-rc.2 以来的 Bug 修复</h3>\n<ul>\n<li>未导出 <code class=\"language-text\">storeKey</code>(<a href=\"https://github.com/vuejs/vuex/commit/4ab294793a2c20ea6040f01f316618682df61fff\" title=\"4ab2947\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">4ab2947</a>)</li>\n<li>修复 webpack 中 tree shaking 未生效 (<a href=\"https://github.com/vuejs/vuex/issues/1906\" title=\"#1906\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">#1906</a>) (<a href=\"https://github.com/vuejs/vuex/issues/1907\" title=\"#1907\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">#1907</a>) (<a href=\"https://github.com/vuejs/vuex/commit/aeddf7a7c618eda7f316f8a6ace8d21eb96c29ff\" title=\"aeddf7a\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">aeddf7a</a>)</li>\n</ul>\n<h2 id=\"原文发布地址\"><a href=\"#%E5%8E%9F%E6%96%87%E5%8F%91%E5%B8%83%E5%9C%B0%E5%9D%80\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>原文发布地址</h2>\n<p><a href=\"https://github.com/vuejs/vuex/releases/tag/v4.0.0\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/vuejs/vuex/releases/tag/v4.0.0</a></p>","timeToRead":4,"frontmatter":{"title":"Vuex 4.0 正式发布！新年官方生态齐聚一堂","date":"February 05, 2021","spoiler":""},"fields":{"slug":"/802370341/","langKey":"en"}}},"pageContext":{"slug":"/802370341/","previous":{"fields":{"slug":"/792714890/","langKey":"en","directoryName":"792714890"},"frontmatter":{"title":"React Core Team 成员开发的火焰图组件技术揭秘。"}},"next":{"fields":{"slug":"/803777729/","langKey":"en","directoryName":"803777729"},"frontmatter":{"title":"尤雨溪：关于 Vue3 和生活，想和前端们聊聊这些"}},"translations":[],"translatedLinks":[]}},"staticQueryHashes":["336482444"]}