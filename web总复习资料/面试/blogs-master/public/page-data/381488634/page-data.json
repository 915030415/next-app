{"componentChunkName":"component---src-templates-blog-post-js","path":"/381488634/","result":{"data":{"site":{"siteMetadata":{"title":"ssh的博客","author":"ssh"}},"markdownRemark":{"id":"b9c95909-b1d8-54b3-b3c9-35e20c9ca4f7","html":"<p><a href=\"https://didi.github.io/cube-ui/#/zh-CN/docs/swipe\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">swipe组件预览地址（手机模式可体验）</a>\n<a href=\"https://github.com/ustbhuangyi\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">作者：黄轶老师</a></p>\n<p>先吹一波黄老，昨天体验swipe组件的时候感受到了什么叫丝滑，这可以说是东半球移动端最好用的swipe组件了吧。</p>\n<p>先来一段文档中的用法的简化版：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>cube<span class=\"token operator\">-</span>swipe<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>li <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"swipe-item-wrapper\"</span> v<span class=\"token operator\">-</span><span class=\"token keyword\">for</span><span class=\"token operator\">=</span><span class=\"token string\">\"(data,index) in swipeData\"</span> <span class=\"token punctuation\">:</span>key<span class=\"token operator\">=</span><span class=\"token string\">\"data.item.id\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>cube<span class=\"token operator\">-</span>swipe<span class=\"token operator\">-</span>item\n          ref<span class=\"token operator\">=</span><span class=\"token string\">\"swipeItem\"</span>\n          <span class=\"token punctuation\">:</span>btns<span class=\"token operator\">=</span><span class=\"token string\">\"data.btns\"</span>\n          <span class=\"token punctuation\">:</span>index<span class=\"token operator\">=</span><span class=\"token string\">\"index\"</span>\n          @btn<span class=\"token operator\">-</span>click<span class=\"token operator\">=</span><span class=\"token string\">\"onBtnClick\"</span><span class=\"token operator\">></span>\n           <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>cube<span class=\"token operator\">-</span>swipe<span class=\"token operator\">-</span>item<span class=\"token operator\">></span>\n   <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>      \n <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>cube<span class=\"token operator\">-</span>swipe<span class=\"token operator\">></span></code></pre></div>\n<p>在cube-ui的项目的src/components/swipe目录下，我们可以看到swipe组件被分为swipe.vue和swipe-item.vue。\n其实swipe就是列表的外层容器组件，负责处理一些全列表的事件。\nswipe-item就是列表中循环出来的某一项元素的组件，负责处理手势等细节。\n我们先从swipe.vue入手：</p>\n<h3 id=\"swipevue\"><a href=\"#swipevue\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>swipe.vue</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>template<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"cube-swipe\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>slot<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>transition<span class=\"token operator\">-</span>group name<span class=\"token operator\">=</span><span class=\"token string\">\"cube-swipe\"</span> tag<span class=\"token operator\">=</span><span class=\"token string\">\"ul\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>li v<span class=\"token operator\">-</span><span class=\"token keyword\">for</span><span class=\"token operator\">=</span><span class=\"token string\">\"(item, index) in data\"</span> <span class=\"token punctuation\">:</span>key<span class=\"token operator\">=</span><span class=\"token string\">\"item.item.value\"</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>cube<span class=\"token operator\">-</span>swipe<span class=\"token operator\">-</span>item\n            <span class=\"token punctuation\">:</span>btns<span class=\"token operator\">=</span><span class=\"token string\">\"item.btns\"</span>\n            <span class=\"token punctuation\">:</span>item<span class=\"token operator\">=</span><span class=\"token string\">\"item.item\"</span>\n            <span class=\"token punctuation\">:</span>index<span class=\"token operator\">=</span><span class=\"token string\">\"index\"</span>\n            <span class=\"token punctuation\">:</span>auto<span class=\"token operator\">-</span>shrink<span class=\"token operator\">=</span><span class=\"token string\">\"autoShrink\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>transition<span class=\"token operator\">-</span>group<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>slot<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span></code></pre></div>\n<p>我们先从template部分入手， 可以看到结构非常简单，就是一个div中给了一个slot子元素，并且slot有个默认值，\n如果用户不传slot的话就默认的带transition-group动效循环出一段cube-swipe-item列表，不使用slot的情况下用户可以传入</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">swipeData<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n        item<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          text<span class=\"token punctuation\">:</span> <span class=\"token string\">'测试1'</span><span class=\"token punctuation\">,</span>\n          value<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        btns<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            action<span class=\"token punctuation\">:</span> <span class=\"token string\">'clear'</span><span class=\"token punctuation\">,</span>\n            text<span class=\"token punctuation\">:</span> <span class=\"token string\">'不再关注'</span><span class=\"token punctuation\">,</span>\n            color<span class=\"token punctuation\">:</span> <span class=\"token string\">'#c8c7cd'</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n            action<span class=\"token punctuation\">:</span> <span class=\"token string\">'delete'</span><span class=\"token punctuation\">,</span>\n            text<span class=\"token punctuation\">:</span> <span class=\"token string\">'删除'</span><span class=\"token punctuation\">,</span>\n            color<span class=\"token punctuation\">:</span> <span class=\"token string\">'#ff3a32'</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        item<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          text<span class=\"token punctuation\">:</span> <span class=\"token string\">'测试2'</span><span class=\"token punctuation\">,</span>\n          value<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        btns<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            action<span class=\"token punctuation\">:</span> <span class=\"token string\">'clear'</span><span class=\"token punctuation\">,</span>\n            text<span class=\"token punctuation\">:</span> <span class=\"token string\">'不再关注'</span><span class=\"token punctuation\">,</span>\n            color<span class=\"token punctuation\">:</span> <span class=\"token string\">'#c8c7cd'</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n            action<span class=\"token punctuation\">:</span> <span class=\"token string\">'delete'</span><span class=\"token punctuation\">,</span>\n            text<span class=\"token punctuation\">:</span> <span class=\"token string\">'删除'</span><span class=\"token punctuation\">,</span>\n            color<span class=\"token punctuation\">:</span> <span class=\"token string\">'#ff3a32'</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        item<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          text<span class=\"token punctuation\">:</span> <span class=\"token string\">'测试3'</span><span class=\"token punctuation\">,</span>\n          value<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        btns<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            action<span class=\"token punctuation\">:</span> <span class=\"token string\">'clear'</span><span class=\"token punctuation\">,</span>\n            text<span class=\"token punctuation\">:</span> <span class=\"token string\">'不再关注'</span><span class=\"token punctuation\">,</span>\n            color<span class=\"token punctuation\">:</span> <span class=\"token string\">'#c8c7cd'</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n            action<span class=\"token punctuation\">:</span> <span class=\"token string\">'delete'</span><span class=\"token punctuation\">,</span>\n            text<span class=\"token punctuation\">:</span> <span class=\"token string\">'删除'</span><span class=\"token punctuation\">,</span>\n            color<span class=\"token punctuation\">:</span> <span class=\"token string\">'#ff3a32'</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>这样一段大而全的json数组，渲染出一个列表，不过这种方式比较不灵活。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>script type<span class=\"token operator\">=</span><span class=\"token string\">\"text/ecmascript-6\"</span><span class=\"token operator\">></span>\n  <span class=\"token keyword\">import</span> CubeSwipeItem <span class=\"token keyword\">from</span> <span class=\"token string\">'./swipe-item.vue'</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">COMPONENT_NAME</span> <span class=\"token operator\">=</span> <span class=\"token string\">'cube-swipe'</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">EVENT_ITEM_CLICK</span> <span class=\"token operator\">=</span> <span class=\"token string\">'item-click'</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">EVENT_BTN_CLICK</span> <span class=\"token operator\">=</span> <span class=\"token string\">'btn-click'</span>\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n    name<span class=\"token punctuation\">:</span> <span class=\"token constant\">COMPONENT_NAME</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">provide</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        swipe<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    props<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      data<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token punctuation\">:</span> Array<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      autoShrink<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token punctuation\">:</span> Boolean<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">created</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>activeIndex <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    methods<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">addItem</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">removeItem</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> index <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">splice</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>index <span class=\"token operator\">&lt;=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>activeIndex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>activeIndex <span class=\"token operator\">-=</span> <span class=\"token number\">1</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">onItemClick</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EVENT_ITEM_CLICK</span><span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">onBtnClick</span><span class=\"token punctuation\">(</span>btn<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> item <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EVENT_BTN_CLICK</span><span class=\"token punctuation\">,</span> btn<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">onItemActive</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>index <span class=\"token operator\">===</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>activeIndex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>activeIndex <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> activeItem <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>activeIndex<span class=\"token punctuation\">]</span>\n          activeItem<span class=\"token punctuation\">.</span><span class=\"token function\">shrink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>activeIndex <span class=\"token operator\">=</span> index\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    components<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      CubeSwipeItem\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></code></pre></div>\n<p>script的data和methods里提供了很多东西，但是在template里却没有使用到，那么我们猜测这些都是提供给子组件使用的，\nprovider里把自身实例提供给了子组件</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"> <span class=\"token function\">provide</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        swipe<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>那么我们接下来就去探究swipe-item组件。</p>\n<h3 id=\"swipe-item\"><a href=\"#swipe-item\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>swipe-item</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>template<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>div ref<span class=\"token operator\">=</span><span class=\"token string\">\"swipeItem\"</span>\n       @transitionend<span class=\"token operator\">=</span><span class=\"token string\">\"onTransitionEnd\"</span>\n       @touchstart<span class=\"token operator\">=</span><span class=\"token string\">\"onTouchStart\"</span>\n       @touchmove<span class=\"token operator\">=</span><span class=\"token string\">\"onTouchMove\"</span>\n       @touchend<span class=\"token operator\">=</span><span class=\"token string\">\"onTouchEnd\"</span>\n       <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"cube-swipe-item\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>slot<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div @click<span class=\"token operator\">=</span><span class=\"token string\">\"clickItem\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"cube-swipe-item-inner border-bottom-1px\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>span<span class=\"token operator\">></span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>slot<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>ul <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"cube-swipe-btns\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>li ref<span class=\"token operator\">=</span><span class=\"token string\">\"btns\"</span>\n          v<span class=\"token operator\">-</span><span class=\"token keyword\">for</span><span class=\"token operator\">=</span><span class=\"token string\">\"btn in btns\"</span>\n          <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"cube-swipe-btn\"</span>\n          <span class=\"token punctuation\">:</span>style<span class=\"token operator\">=</span><span class=\"token string\">\"genBtnStyl(btn)\"</span>\n          @click<span class=\"token punctuation\">.</span>prevent<span class=\"token operator\">=</span><span class=\"token string\">\"clickBtn(btn)\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"text\"</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>btn<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>style lang<span class=\"token operator\">=</span><span class=\"token string\">\"stylus\"</span> rel<span class=\"token operator\">=</span><span class=\"token string\">\"stylesheet/stylus\"</span><span class=\"token operator\">></span>\n  @require <span class=\"token string\">\"../../common/stylus/variable.styl\"</span>\n  <span class=\"token punctuation\">.</span>cube<span class=\"token operator\">-</span>swipe<span class=\"token operator\">-</span>item\n    position<span class=\"token punctuation\">:</span> relative\n  <span class=\"token punctuation\">.</span>cube<span class=\"token operator\">-</span>swipe<span class=\"token operator\">-</span>item<span class=\"token operator\">-</span>inner\n    height<span class=\"token punctuation\">:</span> <span class=\"token number\">60</span>px\n    line<span class=\"token operator\">-</span>height<span class=\"token punctuation\">:</span> <span class=\"token number\">60</span>px\n    font<span class=\"token operator\">-</span>size<span class=\"token punctuation\">:</span> $fontsize<span class=\"token operator\">-</span>large\n    padding<span class=\"token operator\">-</span>left<span class=\"token punctuation\">:</span> <span class=\"token number\">20</span>px\n  <span class=\"token punctuation\">.</span>cube<span class=\"token operator\">-</span>swipe<span class=\"token operator\">-</span>btn\n    display<span class=\"token punctuation\">:</span> flex\n    align<span class=\"token operator\">-</span>items<span class=\"token punctuation\">:</span> center\n    position<span class=\"token punctuation\">:</span> absolute\n    top<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    left<span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token operator\">%</span>\n    height<span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token operator\">%</span>\n    text<span class=\"token operator\">-</span>align<span class=\"token punctuation\">:</span> left\n    font<span class=\"token operator\">-</span>size<span class=\"token punctuation\">:</span> $fontsize<span class=\"token operator\">-</span>large\n    <span class=\"token punctuation\">.</span>text\n      flex<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n      padding<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span> <span class=\"token number\">20</span>px\n      white<span class=\"token operator\">-</span>space<span class=\"token punctuation\">:</span> nowrap\n      color<span class=\"token punctuation\">:</span> $swipe<span class=\"token operator\">-</span>btn<span class=\"token operator\">-</span>color\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>style<span class=\"token operator\">></span></code></pre></div>\n<p>可以看到swipe-item的结构也非常简单， 也提供了slot插槽定制子组件的元素\n并且在子组件的旁边有个初始隐藏的ul结构 用来循环btns来生成侧滑出来的按钮\n.cube-swipe-btn这个类是绝对定位并且left 100% 也就是相对于父relative容器\n.cube-swipe-item的宽度偏移 正好隐藏到边缘外。</p>\n<p>接下来我们看一下script部分</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>script type<span class=\"token operator\">=</span><span class=\"token string\">\"text/ecmascript-6\"</span><span class=\"token operator\">></span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n    getRect<span class=\"token punctuation\">,</span>\n    prefixStyle\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../../common/helpers/dom'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> easeOutQuart<span class=\"token punctuation\">,</span> easeOutCubic <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../../common/helpers/ease'</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getNow <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../../common/lang/date'</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">COMPONENT_NAME</span> <span class=\"token operator\">=</span> <span class=\"token string\">'cube-swipe-item'</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">EVENT_ITEM_CLICK</span> <span class=\"token operator\">=</span> <span class=\"token string\">'item-click'</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">EVENT_BTN_CLICK</span> <span class=\"token operator\">=</span> <span class=\"token string\">'btn-click'</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">EVENT_SCROLL</span> <span class=\"token operator\">=</span> <span class=\"token string\">'scroll'</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">EVENT_ACTIVE</span> <span class=\"token operator\">=</span> <span class=\"token string\">'active'</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">DIRECTION_LEFT</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">DIRECTION_RIGHT</span> <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">STATE_SHRINK</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">STATE_GROW</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n  <span class=\"token keyword\">const</span> easingTime <span class=\"token operator\">=</span> <span class=\"token number\">600</span>\n  <span class=\"token keyword\">const</span> momentumLimitTime <span class=\"token operator\">=</span> <span class=\"token number\">300</span>\n  <span class=\"token keyword\">const</span> momentumLimitDistance <span class=\"token operator\">=</span> <span class=\"token number\">15</span>\n  <span class=\"token keyword\">const</span> directionLockThreshold <span class=\"token operator\">=</span> <span class=\"token number\">5</span>\n  <span class=\"token keyword\">const</span> transform <span class=\"token operator\">=</span> <span class=\"token function\">prefixStyle</span><span class=\"token punctuation\">(</span><span class=\"token string\">'transform'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> transitionProperty <span class=\"token operator\">=</span> <span class=\"token function\">prefixStyle</span><span class=\"token punctuation\">(</span><span class=\"token string\">'transitionProperty'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> transitionDuration <span class=\"token operator\">=</span> <span class=\"token function\">prefixStyle</span><span class=\"token punctuation\">(</span><span class=\"token string\">'transitionDuration'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> transitionTimingFunction <span class=\"token operator\">=</span> <span class=\"token function\">prefixStyle</span><span class=\"token punctuation\">(</span><span class=\"token string\">'transitionTimingFunction'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n    name<span class=\"token punctuation\">:</span> <span class=\"token constant\">COMPONENT_NAME</span><span class=\"token punctuation\">,</span>\n    inject<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'swipe'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    props<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      item<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token punctuation\">:</span> Object<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      btns<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token punctuation\">:</span> Array<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      index<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token punctuation\">:</span> Number<span class=\"token punctuation\">,</span>\n        index<span class=\"token punctuation\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      autoShrink<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token punctuation\">:</span> Boolean<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    watch<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">btns</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$nextTick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">created</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">STATE_SHRINK</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>swipe<span class=\"token punctuation\">.</span><span class=\"token function\">addItem</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">mounted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scrollerStyle <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>swipeItem<span class=\"token punctuation\">.</span>style\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$nextTick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$on</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EVENT_SCROLL</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_handleBtns<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    methods<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">_initCachedBtns</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">const</span> len <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">.</span>length\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            width<span class=\"token punctuation\">:</span> <span class=\"token function\">getRect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>width\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">_handleBtns</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/* istanbul ignore if */</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> len <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">.</span>length\n        <span class=\"token keyword\">let</span> delta <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">let</span> totalWidth <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> btn <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n          <span class=\"token keyword\">let</span> rate <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>totalWidth <span class=\"token operator\">-</span> delta<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> totalWidth\n          <span class=\"token keyword\">let</span> width\n          <span class=\"token keyword\">let</span> translate <span class=\"token operator\">=</span> rate <span class=\"token operator\">*</span> x <span class=\"token operator\">-</span> x\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            width <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>width <span class=\"token operator\">+</span> rate <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX <span class=\"token operator\">-</span> x<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            width <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>width\n          <span class=\"token punctuation\">}</span>\n          delta <span class=\"token operator\">+=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>width\n          btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>width<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px`</span></span>\n          btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span>transform<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`translate(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>translate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px)`</span></span>\n          btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span>transitionDuration<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'0ms'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">_isInBtns</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> parent <span class=\"token operator\">=</span> target\n        <span class=\"token keyword\">let</span> flag <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>parent <span class=\"token operator\">&amp;&amp;</span> parent<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cube-swipe-item'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cube-swipe-btns'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            flag <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n            <span class=\"token keyword\">break</span>\n          <span class=\"token punctuation\">}</span>\n          parent <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">.</span>parentNode\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> flag\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">_calculateBtnsWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> width <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">const</span> len <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">.</span>length\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          width <span class=\"token operator\">+=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>width\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>width\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">_translate</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> useZ<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> translateZ <span class=\"token operator\">=</span> useZ <span class=\"token operator\">?</span> <span class=\"token string\">' translateZ(0)'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">''</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scrollerStyle<span class=\"token punctuation\">[</span>transform<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`translate(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>x<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px,0)</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>translateZ<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> x\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">_transitionProperty</span><span class=\"token punctuation\">(</span>property <span class=\"token operator\">=</span> <span class=\"token string\">'transform'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scrollerStyle<span class=\"token punctuation\">[</span>transitionProperty<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> property\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">_transitionTimingFunction</span><span class=\"token punctuation\">(</span>easing<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scrollerStyle<span class=\"token punctuation\">[</span>transitionTimingFunction<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> easing\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">_transitionTime</span><span class=\"token punctuation\">(</span>time <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scrollerStyle<span class=\"token punctuation\">[</span>transitionDuration<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>time<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">ms`</span></span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">_getComputedPositionX</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> matrix <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">getComputedStyle</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>swipeItem<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        matrix <span class=\"token operator\">=</span> matrix<span class=\"token punctuation\">[</span>transform<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">')'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">', '</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>matrix<span class=\"token punctuation\">[</span><span class=\"token number\">12</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> matrix<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> x\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">_translateBtns</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">,</span> easing<span class=\"token punctuation\">,</span> extend<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/* istanbul ignore if */</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> len <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">.</span>length\n        <span class=\"token keyword\">let</span> delta <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">let</span> translate <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> btn <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">===</span> <span class=\"token constant\">STATE_GROW</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            translate <span class=\"token operator\">=</span> delta\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            translate <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n          <span class=\"token punctuation\">}</span>\n          delta <span class=\"token operator\">+=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>width\n          btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span>transform<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`translate(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>translate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px,0) translateZ(0)`</span></span>\n          btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span>transitionProperty<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'all'</span>\n          btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span>transitionTimingFunction<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> easing\n          btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span>transitionDuration<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>time<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">ms`</span></span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>extend<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>width<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px`</span></span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_initCachedBtns</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_calculateBtnsWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>endTime <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">shrink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">STATE_SHRINK</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$nextTick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">scrollTo</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> easingTime<span class=\"token punctuation\">,</span> easeOutQuart<span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_translateBtns</span><span class=\"token punctuation\">(</span>easingTime<span class=\"token punctuation\">,</span> easeOutQuart<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">grow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">STATE_GROW</span>\n        <span class=\"token keyword\">const</span> extend <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX\n        <span class=\"token keyword\">let</span> easing <span class=\"token operator\">=</span> easeOutCubic\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">scrollTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX<span class=\"token punctuation\">,</span> easingTime<span class=\"token punctuation\">,</span> easing<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_translateBtns</span><span class=\"token punctuation\">(</span>easingTime<span class=\"token punctuation\">,</span> easing<span class=\"token punctuation\">,</span> extend<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">scrollTo</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">,</span> easing<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_transitionProperty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_transitionTimingFunction</span><span class=\"token punctuation\">(</span>easing<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_transitionTime</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_translate</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isInTransition <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">genBtnStyl</span><span class=\"token punctuation\">(</span>btn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token string\">`background: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>btn<span class=\"token punctuation\">.</span>color<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">clickItem</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>swipe<span class=\"token punctuation\">.</span><span class=\"token function\">onItemClick</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EVENT_ITEM_CLICK</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">clickBtn</span><span class=\"token punctuation\">(</span>btn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>swipe<span class=\"token punctuation\">.</span><span class=\"token function\">onBtnClick</span><span class=\"token punctuation\">(</span>btn<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EVENT_BTN_CLICK</span><span class=\"token punctuation\">,</span> btn<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>autoShrink<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">shrink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isInTransition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isInTransition <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n          <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">===</span> <span class=\"token constant\">STATE_SHRINK</span> <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_getComputedPositionX</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_translate</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EVENT_SCROLL</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">onTouchStart</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>swipe<span class=\"token punctuation\">.</span><span class=\"token function\">onItemActive</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EVENT_ACTIVE</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>moved <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movingDirectionX <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">const</span> point <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>touches<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pointX <span class=\"token operator\">=</span> point<span class=\"token punctuation\">.</span>pageX\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pointY <span class=\"token operator\">=</span> point<span class=\"token punctuation\">.</span>pageY\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distX <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distY <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startX <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_transitionTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startTime <span class=\"token operator\">=</span> <span class=\"token function\">getNow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">===</span> <span class=\"token constant\">STATE_GROW</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_isInBtns</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>shrinkTimer <span class=\"token operator\">=</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">shrink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">onTouchMove</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>moved<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">clearTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>shrinkTimer<span class=\"token punctuation\">)</span>\n          e<span class=\"token punctuation\">.</span><span class=\"token function\">stopPropagation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">/* istanbul ignore if */</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isInTransition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n        e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">const</span> point <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>touches<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">let</span> deltaX <span class=\"token operator\">=</span> point<span class=\"token punctuation\">.</span>pageX <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pointX\n        <span class=\"token keyword\">let</span> deltaY <span class=\"token operator\">=</span> point<span class=\"token punctuation\">.</span>pageY <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pointY\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pointX <span class=\"token operator\">=</span> point<span class=\"token punctuation\">.</span>pageX\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pointY <span class=\"token operator\">=</span> point<span class=\"token punctuation\">.</span>pageY\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distX <span class=\"token operator\">+=</span> deltaX\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distY <span class=\"token operator\">+=</span> deltaY\n        <span class=\"token keyword\">let</span> absDistX <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distX<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> absDistY <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distY<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>absDistX <span class=\"token operator\">+</span> directionLockThreshold <span class=\"token operator\">&lt;=</span> absDistY<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">let</span> timestamp <span class=\"token operator\">=</span> <span class=\"token function\">getNow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>timestamp <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>endTime <span class=\"token operator\">></span> momentumLimitTime <span class=\"token operator\">&amp;&amp;</span> absDistX <span class=\"token operator\">&lt;</span> momentumLimitDistance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movingDirectionX <span class=\"token operator\">=</span> deltaX <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token constant\">DIRECTION_RIGHT</span> <span class=\"token punctuation\">:</span> deltaX <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token constant\">DIRECTION_LEFT</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">let</span> newX <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">+</span> deltaX\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newX <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          newX <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newX <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          newX <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">+</span> deltaX <span class=\"token operator\">/</span> <span class=\"token number\">3</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>moved<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>moved <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_translate</span><span class=\"token punctuation\">(</span>newX<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>timestamp <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startTime <span class=\"token operator\">></span> momentumLimitTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startTime <span class=\"token operator\">=</span> timestamp\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startX <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EVENT_SCROLL</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">onTouchEnd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>moved<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movingDirectionX <span class=\"token operator\">===</span> <span class=\"token constant\">DIRECTION_RIGHT</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">shrink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>endTime <span class=\"token operator\">=</span> <span class=\"token function\">getNow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> duration <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>endTime <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startTime\n        <span class=\"token keyword\">let</span> absDistX <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startX<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>duration <span class=\"token operator\">&lt;</span> momentumLimitTime <span class=\"token operator\">&amp;&amp;</span> absDistX <span class=\"token operator\">></span> momentumLimitDistance<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">grow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">shrink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">onTransitionEnd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isInTransition <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_transitionTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_translate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">beforeDestroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>swipe<span class=\"token punctuation\">.</span><span class=\"token function\">removeItem</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></code></pre></div>\n<p>首先看到inject: [‘swipe’]， 使得父swipe组件实例自身可以通过this.swipe访问到，\n接下来看</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">  props<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      item<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token punctuation\">:</span> Object<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      btns<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token punctuation\">:</span> Array<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      index<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token punctuation\">:</span> Number<span class=\"token punctuation\">,</span>\n        index<span class=\"token punctuation\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      autoShrink<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token punctuation\">:</span> Boolean<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>组件接受四个props，item是在不使用slot自定义子组件元素的情况下使用的，我们可以先不看。\nbtns就是描述按钮的数组，形如</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">btns<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n              action<span class=\"token punctuation\">:</span> <span class=\"token string\">'clear'</span><span class=\"token punctuation\">,</span>\n              text<span class=\"token punctuation\">:</span> <span class=\"token string\">'不再关注'</span><span class=\"token punctuation\">,</span>\n              color<span class=\"token punctuation\">:</span> <span class=\"token string\">'#c8c7cd'</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">{</span>\n              action<span class=\"token punctuation\">:</span> <span class=\"token string\">'delete'</span><span class=\"token punctuation\">,</span>\n              text<span class=\"token punctuation\">:</span> <span class=\"token string\">'删除'</span><span class=\"token punctuation\">,</span>\n              color<span class=\"token punctuation\">:</span> <span class=\"token string\">'#ff3a32'</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">]</span></code></pre></div>\n<p>index 接受在外层v-for拿到的index传递给swipe-item组件 便于标识这个swipe-item在swipe容器中的序号。\nautoShrink用于当点击滑块的按钮后，是否需要自动收缩滑块，如果使用自定义插槽，则直接给 cube-swipe-item 传递此值即可。</p>\n<p>看完了props 我们可以按生命周期流程开始看了，先看created周期</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    <span class=\"token function\">created</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">STATE_SHRINK</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>swipe<span class=\"token punctuation\">.</span><span class=\"token function\">addItem</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>this.x用来记录滑动偏移的量，\nthis.state用来记录状态，默认是缩起，\nthis.swipe.addItem(this) 调用父组件的addItem方法把自身实例push到父组件的\nthis.items数组里收集起来。</p>\n<p>初始化完了我们来看</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">mounted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scrollerStyle <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>swipeItem<span class=\"token punctuation\">.</span>style\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$nextTick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$on</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EVENT_SCROLL</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_handleBtns<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>首先通过把这个组件的dom节点的style用this.scrollerStyle记录起来 便于后续操作\n接着调用了this.refresh</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_initCachedBtns</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_calculateBtnsWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>endTime <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>可以看到 我们做了两个初始化工作<em>initCachedBtns和</em>calculateBtnsWidth，并且把endTime标识为0\n我们先看_initCachedBtns</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">_initCachedBtns</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">const</span> len <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">.</span>length\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            width<span class=\"token punctuation\">:</span> <span class=\"token function\">getRect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>width\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>this.cachedBtns记录按钮宽度大小，\n最后生成形如[ {width: 50}, {width: 50 } ] 这样的记录，\n再来看_calculateBtnsWidth</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">_calculateBtnsWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> width <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">const</span> len <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">.</span>length\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          width <span class=\"token operator\">+=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>width\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>width\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>其实就是计算出按钮的总长度\n然后记录在this.maxScrollX变量上，用于标识向左滑动的最大距离。</p>\n<p>mounted的最后this.$on(EVENT<em>SCROLL, this.</em>handleBtns)\n注册了EVENT<em>SCROLL事件的回调函数为 this.</em>handleBtns， 我们先记下来 等到触发的时候再详细去讲。</p>\n<p>初始化的流程到这就结束了， 那么接下来我们就可以看这个组件的核心 touch事件了，touch事件全部注册在最外层的dom节点上</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"> <span class=\"token operator\">&lt;</span>div ref<span class=\"token operator\">=</span><span class=\"token string\">\"swipeItem\"</span>\n       @transitionend<span class=\"token operator\">=</span><span class=\"token string\">\"onTransitionEnd\"</span>\n       @touchstart<span class=\"token operator\">=</span><span class=\"token string\">\"onTouchStart\"</span>\n       @touchmove<span class=\"token operator\">=</span><span class=\"token string\">\"onTouchMove\"</span>\n       @touchend<span class=\"token operator\">=</span><span class=\"token string\">\"onTouchEnd\"</span>\n       <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"cube-swipe-item\"</span><span class=\"token operator\">></span></code></pre></div>\n<p>我们顺着流程onTouchStart - onTouchMove - onTouchEnd - onTransitionEnd一步一步来走。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">onTouchStart</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>swipe<span class=\"token punctuation\">.</span><span class=\"token function\">onItemActive</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EVENT_ACTIVE</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>moved <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movingDirectionX <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">const</span> point <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>touches<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pointX <span class=\"token operator\">=</span> point<span class=\"token punctuation\">.</span>pageX\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pointY <span class=\"token operator\">=</span> point<span class=\"token punctuation\">.</span>pageY\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distX <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distY <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startX <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_transitionTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startTime <span class=\"token operator\">=</span> <span class=\"token function\">getNow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">===</span> <span class=\"token constant\">STATE_GROW</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_isInBtns</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>shrinkTimer <span class=\"token operator\">=</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">shrink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p> this.swipe.onItemActive(this.index)\n首先通知父组件“我被触摸了”， 这里调用父swipe组件的onItemActive方法</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"> <span class=\"token function\">onItemActive</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>index <span class=\"token operator\">===</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>activeIndex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>activeIndex <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> activeItem <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>activeIndex<span class=\"token punctuation\">]</span>\n          activeItem<span class=\"token punctuation\">.</span><span class=\"token function\">shrink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>activeIndex <span class=\"token operator\">=</span> index\n      <span class=\"token punctuation\">}</span></code></pre></div>\n<p>如果父元素中有已经被触摸左滑展开的swipe-item记录 并且和这个新的swipe-item不是同一个 就通知上一个子组件shrink() 收起， 并且在swipe组件中记录this.activeIndex = index新的子组件序号\nthis.pointX = point.pageX\nthis.pointY = point.pageY\nthis.distX = 0\nthis.distY = 0\nthis.startX = this.x\n记录了这个点的xy值 把dist当前手指的触碰距离值置为0，把this.x的值赋值给this.startX\n调用this._transitionTime()</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">      <span class=\"token function\">_transitionTime</span><span class=\"token punctuation\">(</span>time <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scrollerStyle<span class=\"token punctuation\">[</span>transitionDuration<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>time<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">ms`</span></span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>把style的transitionDuration置为0 手指触摸的时候不需要transitionDuration来帮我们完成动画过渡效果的，所以先把这个过渡关闭</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startTime <span class=\"token operator\">=</span> <span class=\"token function\">getNow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 记录触摸开始的时间</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">===</span> <span class=\"token constant\">STATE_GROW</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_isInBtns</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>shrinkTimer <span class=\"token operator\">=</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">shrink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span></code></pre></div>\n<p>这段代码做了一个判断 如果当前的状态是展开 并且点击的位置不在btn内部\n就设置了一个定时器 如果touchstart过了300ms 就会把这个swipe-item收起\n总结起来就是一系列初始化值的设置，接下来看onTouchMove\nonTouchMove的方法比较长 也是滑动动画的核心，我们跟着注释一行一行来解读</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">onTouchMove</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>moved<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// 如果moved变量为true 也就是正在移动中， 就把300ms后自动缩进的定时器清空掉</span>\n          <span class=\"token function\">clearTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>shrinkTimer<span class=\"token punctuation\">)</span>\n         <span class=\"token comment\">// 并且阻止事件冒泡</span>\n          e<span class=\"token punctuation\">.</span><span class=\"token function\">stopPropagation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">/* istanbul ignore if */</span>\n\n       <span class=\"token comment\">// 如果已经在进行动画 就直接return </span>\n       <span class=\"token comment\">// 展开动画和缩起动画的过程中这个值都是true</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isInTransition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// 阻止浏览器默认touch行为，比如页面滚动</span>\n        e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">const</span> point <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>touches<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n\n        <span class=\"token comment\">// 相对于上次触发touchmove时候横向的偏移量deltaX</span>\n        <span class=\"token keyword\">let</span> deltaX <span class=\"token operator\">=</span> point<span class=\"token punctuation\">.</span>pageX <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pointX\n        <span class=\"token comment\">// 相对于上次触发touchmove时候竖直方向的偏移量deltaY</span>\n        <span class=\"token keyword\">let</span> deltaY <span class=\"token operator\">=</span> point<span class=\"token punctuation\">.</span>pageY <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pointY\n\n        <span class=\"token comment\">// 记录最新的pointX和Y</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pointX <span class=\"token operator\">=</span> point<span class=\"token punctuation\">.</span>pageX\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pointY <span class=\"token operator\">=</span> point<span class=\"token punctuation\">.</span>pageY\n\n        <span class=\"token comment\">// 本次从touchstart事件开始移动的横向总距离</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distX <span class=\"token operator\">+=</span> deltaX\n\n         <span class=\"token comment\">// 本次从touchstart事件开始移动的纵向总距离</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distY <span class=\"token operator\">+=</span> deltaY\n\n       <span class=\"token comment\">// distX和distY的绝对值</span>\n        <span class=\"token keyword\">let</span> absDistX <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distX<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> absDistY <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distY<span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// 如果横向距离 加directionLockThreshold(被设置成了5) </span>\n        <span class=\"token comment\">// 小与纵向移动的距离 就判定成上下滑动 不做任何行为</span>\n        <span class=\"token comment\">//这其实就是稍微大于45度角的角度以内的滑动会被识别为侧滑</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>absDistX <span class=\"token operator\">+</span> directionLockThreshold <span class=\"token operator\">&lt;=</span> absDistY<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">let</span> timestamp <span class=\"token operator\">=</span> <span class=\"token function\">getNow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// momentumLimitTime和momentumLimitDistance</span>\n        <span class=\"token comment\">// 定义两次动画的最小间隔事件和最小间隔移动距离</span>\n        <span class=\"token comment\">// 距离上次touchend 300ms内并且 横向移动小于15的move事件会被无视</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>timestamp <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>endTime <span class=\"token operator\">></span> momentumLimitTime <span class=\"token operator\">&amp;&amp;</span> absDistX <span class=\"token operator\">&lt;</span> momentumLimitDistance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// movingDirectionX 滑动的方向， 如果deltaX大于0 则是向右滑动-1 </span>\n        <span class=\"token comment\">// 如果deltaX小于0则是左滑-1 如果等于0 则记录为0</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movingDirectionX <span class=\"token operator\">=</span> deltaX <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token constant\">DIRECTION_RIGHT</span> <span class=\"token punctuation\">:</span> deltaX <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token constant\">DIRECTION_LEFT</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n        <span class=\"token comment\">// this.x在执行_translate动画的之后会被更新成当前的translateX值， </span>\n\n       <span class=\"token comment\">// newX拿到了到上次move为止偏移的x值 </span>\n       <span class=\"token comment\">// 加上本次move偏移的deltaX值</span>\n       <span class=\"token comment\">// 计算出newX也就是下一次应该_translate到x位置值，</span>\n       <span class=\"token comment\">// 这个值一定是负数，因为我们的按钮组一定是向左做偏移translateX(-x)</span>\n       <span class=\"token comment\">//  当然这个值不能直接交给_translate方法 我们要做一些边界值处理</span>\n        <span class=\"token keyword\">let</span> newX <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">+</span> deltaX\n        <span class=\"token comment\">// 不能大于0的边界限制， 保证向右滑动不能超出边缘</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newX <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          newX <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// 如果X的值比最大的maxScrollX值还小</span>\n        <span class=\"token comment\">// maxScrollX的值在refresh中</span>\n        <span class=\"token comment\">// 被设置成了按钮组的总width的负值</span>\n        <span class=\"token comment\">// 用比较好理解的方法 就是向左拉到了极限值</span>\n        <span class=\"token comment\">// 那么你下次再拉30px 只会向左做10px的动画</span>\n        <span class=\"token comment\">// 给你一种有阻力的感觉</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newX <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          newX <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">+</span> deltaX <span class=\"token operator\">/</span> <span class=\"token number\">3</span>\n        <span class=\"token punctuation\">}</span>\n\n       <span class=\"token comment\">// 如果moved是false 记录为true</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>moved<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>moved <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n        <span class=\"token punctuation\">}</span>\n       <span class=\"token comment\">// 调用_translate 真正去操作dom左偏移的行为</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_translate</span><span class=\"token punctuation\">(</span>newX<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\n       <span class=\"token comment\">// 如果这次move的事件减去开始事件小于momentumLimitTime边界值300ms</span>\n       <span class=\"token comment\">// 就把这次move手指所在的值定义为下次计算的开始值，好做到手指短暂离开屏幕 动画也可以衔接上</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>timestamp <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startTime <span class=\"token operator\">></span> momentumLimitTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// 重置startTime为当前时间</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startTime <span class=\"token operator\">=</span> timestamp\n          <span class=\"token comment\">// 重置startX为当前的偏移值x</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startX <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// 触发EVENT_SCROLL事件 带出当前的x值。</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EVENT_SCROLL</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>总结touchmove事件 核心就是根据当前手指的x值和start时的x值 调用_translate让dom去做一些偏移</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">      <span class=\"token function\">_translate</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> useZ<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> translateZ <span class=\"token operator\">=</span> useZ <span class=\"token operator\">?</span> <span class=\"token string\">' translateZ(0)'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">''</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scrollerStyle<span class=\"token punctuation\">[</span>transform<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`translate(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>x<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px,0)</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>translateZ<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> x\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p><em>translate很简单 把x值写入dom样式里 并且translateZ(0)开启硬件加速\n然后更新实例上的this.x 最后还要触发一个EVENT</em>SCROLL\n我们在created里看到了这个EVENT<em>SCROLL事件注册的回调是</em>handleBtns\n其实就是在touchmove的时候也驱动按钮组做一些动画\n_handleBtns</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">      <span class=\"token comment\">// 根据当前的x值驱动每个按钮去做向左滑动动画</span>\n      <span class=\"token comment\">// 并且如果超出了最大x距离 还要让按钮变长</span>\n      <span class=\"token comment\">// 让用户有种按钮有弹性拉动的感觉</span>\n     <span class=\"token function\">_handleBtns</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/* istanbul ignore if */</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> len <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">.</span>length\n        <span class=\"token keyword\">let</span> delta <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">let</span> totalWidth <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> btn <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n          <span class=\"token keyword\">let</span> rate <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>totalWidth <span class=\"token operator\">-</span> delta<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> totalWidth\n          <span class=\"token keyword\">let</span> width\n          <span class=\"token keyword\">let</span> translate <span class=\"token operator\">=</span> rate <span class=\"token operator\">*</span> x <span class=\"token operator\">-</span> x\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            width <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>width <span class=\"token operator\">+</span> rate <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX <span class=\"token operator\">-</span> x<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            width <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>width\n          <span class=\"token punctuation\">}</span>\n          delta <span class=\"token operator\">+=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>width\n          btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>width<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px`</span></span>\n          btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span>transform<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`translate(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>translate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px)`</span></span>\n          btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span>transitionDuration<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'0ms'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">onTouchEnd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n       <span class=\"token comment\">// 如果moved变量为false 什么也不做</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>moved<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n       \n        <span class=\"token comment\">// 如果是向右滑动 调用shrink缩起滑块</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>movingDirectionX <span class=\"token operator\">===</span> <span class=\"token constant\">DIRECTION_RIGHT</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">shrink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// this.endTime设置为当前时间</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>endTime <span class=\"token operator\">=</span> <span class=\"token function\">getNow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// 从开始滑动到结束的时间间隔</span>\n        <span class=\"token keyword\">let</span> duration <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>endTime <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startTime\n        <span class=\"token comment\">// 本次滑动的总距离</span>\n        <span class=\"token keyword\">let</span> absDistX <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>startX<span class=\"token punctuation\">)</span>\n\n        \n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>duration <span class=\"token operator\">&lt;</span> momentumLimitTime <span class=\"token operator\">&amp;&amp;</span> absDistX <span class=\"token operator\">></span> momentumLimitDistance<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// 时间间隔&lt;300ms 滑动距离>15 或者滑动距离x比最大滑动距离的一半要小 就展开</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">grow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">//  否则收起</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">shrink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span></code></pre></div>\n<p>touchend的核心逻辑就是根据记录的一些变量判断是要调用展开还是收起\n展开grow</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">      <span class=\"token function\">grow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 状态记录为展开状态</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">STATE_GROW</span>\n        <span class=\"token comment\">// extend记录为x是否比最大滑动距离要小</span>\n        <span class=\"token keyword\">const</span> extend <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX\n        <span class=\"token comment\">// 展开的贝塞尔曲线描述</span>\n        <span class=\"token keyword\">let</span> easing <span class=\"token operator\">=</span> easeOutCubic\n        <span class=\"token comment\">// 调用scrollTo，值定义为完全展开的x值</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">scrollTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maxScrollX<span class=\"token punctuation\">,</span> easingTime<span class=\"token punctuation\">,</span> easing<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 调用_translateBtns让按钮组做动画</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_translateBtns</span><span class=\"token punctuation\">(</span>easingTime<span class=\"token punctuation\">,</span> easing<span class=\"token punctuation\">,</span> extend<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>我们来看看scrollTo方法如何让容器偏移到最大滑动距离</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">     <span class=\"token function\">scrollTo</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">,</span> easing<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 设定transform-property为'transform'</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_transitionProperty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 设定transform过渡动画为easing贝塞尔曲线</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_transitionTimingFunction</span><span class=\"token punctuation\">(</span>easing<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 设定过渡时间</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_transitionTime</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 设定transformX值 开始执行动画</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_translate</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 有过渡时间的情况下 把isInTransition变量置为true</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isInTransition <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>其实scrollTo就是给容器设定了一系列的transform的css值，让css帮我们做动画\n再看_translateBtns</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">_translateBtns</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">,</span> easing<span class=\"token punctuation\">,</span> extend<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/* istanbul ignore if */</span>\n        <span class=\"token comment\">// 如果没有btns 就啥也不做</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// 遍历btn组的dom节点，</span>\n        <span class=\"token comment\">// 给按钮也设置一系列css transform 让按钮一个个做对应的动画</span>\n        <span class=\"token comment\">// 并且如果extend为true 证明此时按钮被拉到超出最大距离 width被变长了</span>\n        <span class=\"token comment\">// 要重置为之前的width</span>\n        <span class=\"token keyword\">const</span> len <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">.</span>length\n        <span class=\"token keyword\">let</span> delta <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">let</span> translate <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> btn <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>btns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">===</span> <span class=\"token constant\">STATE_GROW</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            translate <span class=\"token operator\">=</span> delta\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            translate <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n          <span class=\"token punctuation\">}</span>\n          delta <span class=\"token operator\">+=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>width\n          btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span>transform<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`translate(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>translate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px,0) translateZ(0)`</span></span>\n          btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span>transitionProperty<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'all'</span>\n          btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span>transitionTimingFunction<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> easing\n          btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span>transitionDuration<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>time<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">ms`</span></span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>extend<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            btn<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cachedBtns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>width<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px`</span></span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>再来看缩起shrink</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">      <span class=\"token function\">shrink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">=</span> <span class=\"token constant\">STATE_SHRINK</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$nextTick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">scrollTo</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> easingTime<span class=\"token punctuation\">,</span> easeOutQuart<span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_translateBtns</span><span class=\"token punctuation\">(</span>easingTime<span class=\"token punctuation\">,</span> easeOutQuart<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>先调用了stop\nstop中先把this.isInTransition置为false\n在touchstart时候也会调用stop 所以要根据state判断目标值\n如果状态已经是缩起状态STATE<em>SHRINK， 则目标值是0\n然后</em>translate过渡到x位置\n并且通过EVENT_SCROLL事件通知按钮组也过渡到x位置</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">      <span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isInTransition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isInTransition <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n          <span class=\"token keyword\">let</span> x <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state <span class=\"token operator\">===</span> <span class=\"token constant\">STATE_SHRINK</span> <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_getComputedPositionX</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_translate</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EVENT_SCROLL</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>最后在nextTick里调用scrollTo和<em>translateBtns分别把容器dom和按钮组动画移动到缩起状态原位\n因为此时state已经是STATE</em>SHRINK了 所以_translateBtns内部会判定x的目标值为0</p>\n<p>至此touch事件三剑客都分析完毕了，内部有些细节实现的很精巧\n在动画结束的时候会调用onTransitionEnd，做一些状态的重置。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">      <span class=\"token function\">onTransitionEnd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isInTransition <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_transitionTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">_translate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span></code></pre></div>\n<p>另外在按钮上点击会触发clickBtn方法，驱动‘btn-click’事件的触发\n并且判断autoShrink的情况下自动收缩起按钮组</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">      <span class=\"token function\">clickBtn</span><span class=\"token punctuation\">(</span>btn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>swipe<span class=\"token punctuation\">.</span><span class=\"token function\">onBtnClick</span><span class=\"token punctuation\">(</span>btn<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EVENT_BTN_CLICK</span><span class=\"token punctuation\">,</span> btn<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>autoShrink<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">shrink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>","timeToRead":18,"frontmatter":{"title":"cube-ui源码学习 swipe组件","date":"November 16, 2018","spoiler":""},"fields":{"slug":"/381488634/","langKey":"en"}}},"pageContext":{"slug":"/381488634/","previous":{"fields":{"slug":"/378986299/","langKey":"en","directoryName":"378986299"},"frontmatter":{"title":"Vue源码学习 观察属性watch"}},"next":{"fields":{"slug":"/383686801/","langKey":"en","directoryName":"383686801"},"frontmatter":{"title":"Vue源码学习 nextTick"}},"translations":[],"translatedLinks":[]}},"staticQueryHashes":["336482444"]}